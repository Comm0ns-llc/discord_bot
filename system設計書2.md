# Comm0ns Discord 統合システム設計書 v2

**作成日**: 2026-02-13
**更新日**: 2026-02-13
**関連**: [[Comm0ns構想]] [[Comm0ns_人物評価システム]] [[Comm0ns_内部通貨システム]]
**設計原則**: まず土台として機能させ、逐次修正を加える（反復的開発）

---

## 目次

1. [現状と課題](#1-現状と課題)
2. [設計思想](#2-設計思想)
3. [メッセージ分類体系](#3-メッセージ分類体系)
4. [自動分類の実装方式](#4-自動分類の実装方式)
5. [ボーナス・乗算システム](#5-ボーナス乗算システム)
6. [信頼スコア（TS）連携](#6-信頼スコアts連携)
7. [議決権システム](#7-議決権システム)
8. [アチーブメント・称号システム](#8-アチーブメント称号システム)
9. [Issue管理・開発評価](#9-issue管理開発評価)
10. [ダッシュボード & 可視化](#10-ダッシュボード--可視化)
11. [技術構成](#11-技術構成)
12. [実装ロードマップ](#12-実装ロードマップ)
13. [リスクと対策](#13-リスクと対策)
14. [付録](#14-付録)
15. [付録](#15-付録)

---

## 1. 現状と課題

### 現行ルール
| アクション | ポイント |
|-----------|---------|
| 発言 | +3 pt |
| スタンプ（リアクション） | +1 pt |

### 課題
現行は「量」のみを計測しており、以下が区別できない。

- 有益なURL・記事のシェア vs 「おはよう」の一言
- コミュニティの雰囲気づくりへの貢献 vs ただの雑談
- 情報の質・希少性
- 誰がどれだけコミュニティの意思決定に関与すべきか
- 貢献に対する可視的な報酬・承認

→ **「量」に加え「質」を測り、それを議決権・称号・開発評価へ接続する統合システム**が必要。

---

## 2. 設計思想

### 全体アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                    Discord上の活動                            │
│  発言 / リアクション / VC / クエスト / Issue / コードレビュー   │
└──────────────────────────┬──────────────────────────────────┘
                           ▼
┌─────────────────────────────────────────────────────────────┐
│               計測レイヤー（自動分類 + 人間評価）              │
│  ルールベース → AI分類 → 人間レビュー / 実績検知              │
└──────────────────────────┬──────────────────────────────────┘
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                  CP（貢献ポイント）台帳                       │
│              × TS（信頼スコア）倍率 = 実効CP                  │
└──────┬──────────┬──────────┬──────────┬────────────────────┘
       ▼          ▼          ▼          ▼
   ┌────────┐ ┌────────┐ ┌────────┐ ┌────────────┐
   │ 議決権  │ │ 称号   │ │ C0通貨 │ │ アクセス権  │
   │ (Vote) │ │(Title) │ │(Token) │ │ (Access)   │
   └────────┘ └────────┘ └────────┘ └────────────┘
```

### 人物評価システムとの整合
Comm0ns人物評価システムの2軸（CP: 貢献ポイント / TS: 信頼スコア）をDiscord活動に適用する。Discord上の活動はすべて **CP** の加算対象として計測し、**TS** はルール違反等の減点イベント時にのみ変動する。

### 基本方針
1. **自動計測できるものは自動で**（Bot + AI分類）
2. **分類の透明性**（なぜそのスコアになったか各自が確認可能）
3. **反復改善**（重み係数はシーズンごとに見直す）
4. **貢献した人が国づくりに深く関われる**（CP → 議決権への接続）
5. **楽しさの設計**（アチーブメント・称号でゲーミフィケーション）

---

## 3. メッセージ分類体系

すべての発言を5カテゴリに自動分類し、カテゴリごとに異なるCP重みを付与する。

### カテゴリ定義

| # | カテゴリ | 略称 | 説明 | 例 |
|---|---------|------|------|-----|
| 1 | **情報シェア** | `INFO` | URL・記事・資料・データなど参照価値のある情報共有 | ニュース記事URL、論文リンク、ツール紹介 |
| 2 | **知見・意見** | `INSIGHT` | 自分の経験・分析・提案などオリジナル思考を伴う発言 | 「〜を試した結果こうだった」「この件は〜だと思う」 |
| 3 | **コミュニティ活性化** | `VIBE` | 場の空気づくり、盛り上げ、歓迎、励まし | 「おつかれ！」「それいいね！」、ミーム共有 |
| 4 | **運営・調整** | `OPS` | イベント告知、スケジュール調整、タスク管理 | 「定例は金曜に変更」「誰か担当できる？」 |
| 5 | **その他** | `MISC` | 上記に該当しない日常会話・独り言 | 「あー」「w」「なるほど」（単体） |

### CP付与テーブル（初期値）

| アクション | 基本CP | 備考 |
|-----------|--------|------|
| 発言: `INFO` | **5** | URL含有 + AI判定 |
| 発言: `INSIGHT` | **4** | 一定文字数以上 + AI判定 |
| 発言: `VIBE` | **3** | 現行の「発言 3pt」に相当 |
| 発言: `OPS` | **4** | 運営活動を重視 |
| 発言: `MISC` | **1** | 最低保証（参加自体に価値） |
| リアクション付与 | **1** | 現行維持 |
| スレッド作成 | **3** | 議論の起点を評価 |
| スレッド内返信 | **2** | 対話の深化を評価 |
| ボイスチャット参加 | **2/10分** | 在席時間ベース（上限あり） |

> **調整原則**: `INFO` と `INSIGHT` が最も高く、`MISC` が最も低い。ただし `VIBE` もゼロにはしない。Comm0nsは「居場所」としての価値も重視する。

---

## 4. 自動分類の実装方式

### 3段階フィルタ

```
Message
  │
  ├─[Stage 1] ルールベース判定（即時・低コスト）
  │   ├─ URL含有 → INFO候補
  │   ├─ 運営チャンネル投稿 → OPS候補
  │   ├─ 文字数 < 5 & 絵文字のみ → VIBE候補
  │   └─ 判定不能 → Stage 2へ
  │
  ├─[Stage 2] AI分類（バッチ処理・日次）
  │   ├─ Claude API / ローカルLLMによる文脈分類
  │   ├─ 直前5メッセージの文脈を含めて判定
  │   └─ 分類結果 + 確信度スコアを返却
  │
  └─[Stage 3] 人間レビュー（例外処理）
      ├─ AI確信度 < 0.6 をキューに格納
      └─ 運営メンバーが週次でレビュー・修正
```

### Stage 1: ルールベース判定（即時）

```python
def rule_based_classify(message):
    text = message.content
    channel = message.channel.name

    if contains_url(text):
        return "INFO", 0.7
    if channel in OPS_CHANNELS:
        return "OPS", 0.6
    if len(strip_emoji(text)) < 5:
        return "VIBE", 0.8
    if len(text) > 200:
        return "INSIGHT", 0.4
    return None, 0.0  # → Stage 2
```

### Stage 2: AI分類（バッチ・日次）

日次で未分類メッセージをまとめてAI APIに送信。直前5メッセージの文脈を含めて判定し、カテゴリ・確信度・理由を返却。初期フェーズはコスト低。規模拡大時はローカルLLM（Ollama等）へ移行検討。

### Stage 3: 人間レビュー

- AI確信度 < 0.6 → `#review-queue` に自動投稿
- 運営がリアクション（✅ INFO / 💡 INSIGHT / 🎉 VIBE / ⚙️ OPS / ❓ MISC）で確定
- 確定データはAI分類の学習データとしてフィードバック

## 5. ボーナス・乗算システム

### 連続参加ボーナス（ログインストリーク）

| 連続日数 | 日次ボーナス |
|---------|------------|
| 3日 | +2 CP |
| 7日 | +5 CP |
| 30日 | +15 CP |

- 「参加」= その日に1回以上の発言 or リアクション
- ストリーク途切れてもペナルティなし

### チャンネル重み係数

| チャンネル種別 | 係数 | 理由 |
|--------------|------|------|
| プロジェクト系 (`#開発`, `#農業`, `#本のコモンズ`) | ×1.2 | 実務に直結 |
| 知識共有系 (`#学び`, `#記事シェア`) | ×1.2 | 知の資産形成 |
| 一般雑談系 (`#雑談`, `#自己紹介`) | ×1.0 | 基準値 |
| 趣味系 (`#ゲーム`, `#音楽`) | ×0.8 | 間接的な貢献 |

> 係数は四半期ごとに運営会議でレビュー。

### クエスト達成ボーナス

```
/quest create "倉庫片付け" reward:50 deadline:2026-02-20
/quest complete @ユーザー "倉庫片付け"
```

---

## 6. 信頼スコア（TS）連携

### 減点イベント

| イベント | TS減点 | 検知方法 |
|---------|--------|---------|
| 攻撃的言動 | -10〜-30 | AI検知 + 通報 → 運営判定 |
| スパム投稿（CP稼ぎ） | -15 | 異常検知 |
| 虚偽情報の意図的拡散 | -20 | 通報 → 運営判定 |
| イベント無断キャンセル | -5 | 手動記録 |
| 個人情報の無断共有 | -25 | 通報 → 運営判定 |

### TS → CP倍率

```
実効CP = 獲得CP × (TS / 100)

TS = 100 → ×1.0 （フル）
TS = 80  → ×0.8
TS = 50  → ×0.5
TS < 30  → BAN検討対象
```

### TS回復

- 30日間問題なし → +5 TS（月次自動回復、上限100）

---

## 7. 議決権システム

### 設計思想

Comm0nsの方針決定は「貢献した人ほど国づくりに深く関われる」原則に基づく。ただし、全員に最低限の発言権は保障し、資本力や古参だけが支配しない構造をとる。

### 7-1. 議決権ウェイト（Voting Power: VP）

CPの累積量に基づいて、各メンバーに議決権ウェイトを付与する。

```
VP = floor(log2(累積実効CP + 1)) + 1
```

| 累積実効CP | VP（票の重み） | 目安 |
|-----------|--------------|------|
| 0 | 1 | 新規参加者（最低保障） |
| 1〜15 | 1 | 参加して数日 |
| 16〜63 | 2 | 1〜2週間の活動 |
| 64〜255 | 3 | 1ヶ月程度の活動 |
| 256〜1023 | 4 | 数ヶ月の継続貢献 |
| 1024〜4095 | 5 | 半年〜の中核メンバー |
| 4096〜 | 6 | 長期の高貢献者 |

**対数スケールを採用する理由:**
- CPが青天井で積み上がるため、線形だと古参の権力が圧倒的になる
- 対数により「大量に稼いでも票が少ししか増えない」逓減構造を作る
- 最低VP = 1 を保障し、全員に声を持たせる
- 上限VP = 6 でキャップをかけ、権力集中を物理的に制限する

**TS（信頼スコア）による補正:**

```
有効VP = VP × (TS / 100)   ※小数点以下切り捨て、最低1

例: VP=4, TS=60 → 有効VP = floor(4 × 0.6) = 2
例: VP=3, TS=100 → 有効VP = 3（フル）
```

信頼を損なう行動をとったメンバーは、貢献量があっても議決権が制限される。

### 7-2. 投票の種類と成立条件

| 投票種別 | 説明 | 必要条件 | 成立要件 |
|---------|------|---------|---------|
| **通常決議** | 日常的な運営判断、ルール微調整 | 誰でも起案可 | VP加重で過半数 |
| **重要決議** | システム変更、新規プロジェクト承認、本設計書の採択 | CP 100以上のメンバーが起案 | VP加重で2/3以上 + 投票率50%以上 |
| **緊急決議** | BAN、重大ルール違反への対処 | 運営ロール保持者が起案 | VP加重で過半数（24時間以内） |
| **世論調査** | 意見収集（拘束力なし） | 誰でも起案可 | 成立要件なし |

### 7-3. 投票フロー（Discord実装）

```
[起案]
/vote create type:重要決議 title:"貢献度計測システムv2の導入"
  description:"本設計書に基づく新評価システムを導入する"
  duration:7d
  options:"賛成,反対,修正条件付き賛成"

     ↓ Botが #投票 チャンネルに投票Embedを生成

[投票期間]
  - メンバーがリアクションまたはボタンで投票
  - 1人1票（変更可）
  - 投票状況はリアルタイムでEmbed更新（VP加重の割合をバー表示）
  - 残り24時間で自動リマインド

     ↓ 期間終了

[集計・結果]
  - VP加重による集計結果を自動表示
  - 成立要件を満たしたか判定
  - 結果は #議決ログ に永続記録
```

### 7-4. 投票に関するCP付与

投票行為自体もComm0nsへの貢献として評価する。

| アクション | CP | 備考 |
|-----------|-----|------|
| 投票に参加 | +3 | 1決議につき1回 |
| 起案（通常・世論調査） | +5 | 起案自体がOPS貢献 |
| 起案（重要決議） | +10 | より大きな議論を牽引 |

### 7-5. 安全弁：ブランチ（ハードフォーク）

議事録にもある通り、意見が根本的に割れた場合は無理に多数決で決着させず、**ブランチを切る**ことを認める。

- 重要決議で賛成が50%〜66%の「グレーゾーン」に着地した場合、反対派は「ブランチ提案」を出せる
- ブランチは独自ルールで運用しつつ、Comm0nsネットワークとの連携は維持
- ブランチ後も相互のCPは一定比率で認め合う

---

## 8. アチーブメント・称号システム

### 設計思想

数値だけでは伝わらない「個性」と「誇り」を可視化する。称号はDiscordのロール（表示名の横に色付きで表示）として自動付与され、コミュニティ内での存在感と帰属意識を高める。

### 8-1. チャンネル覇者（Channel Champion）

**各チャンネルで最も発言量が多いメンバーに月次で自動付与。**

| チャンネル | 称号名 | ロール色 | 備考 |
|-----------|--------|---------|------|
| `#政治` | 🏛️ **政治の主** | ロイヤルブルー | |
| `#技術` | ⚡ **技術の主** | エレクトリックブルー | |
| `#くだらない` | 🤡 **くだらないの主** | ピンク | |
| `#学び` | 📚 **学びの主** | グリーン | |
| `#音楽` | 🎵 **音楽の主** | パープル | |
| `#ゲーム` | 🎮 **ゲームの主** | オレンジ | |

**ルール:**
- 月初に前月のチャンネル別発言数（実効CP加重）を集計
- 1位のメンバーに称号ロールを自動付与（前月保持者からは自動剥奪）
- 同率1位の場合は両者に付与
- 称号は「現在の保持」であり、失っても履歴には残る
- Botが `#称号発表` で月初に発表（「今月の政治の主は @xxx！」）

### 8-2. 累積アチーブメント（Milestone Achievements）

**特定の閾値を超えた時点で永続的に付与。一度獲得したら失われない。**

#### カテゴリ別マイルストーン

| カテゴリ | 回数 | 称号 | 備考 |
|---------|------|------|------|
| `INFO` | 50回 | 📰 **情報屋** | |
| `INFO` | 200回 | 🗞️ **ジャーナリスト** | |
| `INFO` | 500回 | 📡 **放送局** | |
| `INSIGHT` | 50回 | 💭 **思索家** | |
| `INSIGHT` | 200回 | 🧠 **知恵袋** | |
| `INSIGHT` | 500回 | 🎓 **賢者** | |
| `VIBE` | 100回 | 😊 **ムードメーカー** | |
| `VIBE` | 500回 | 🌞 **太陽** | |
| `VIBE` | 1000回 | 🎪 **祭りの神** | |
| `OPS` | 30回 | 🔧 **裏方** | |
| `OPS` | 100回 | ⚙️ **参謀** | |
| `OPS` | 300回 | 🏗️ **建国の柱** | |

#### 総合マイルストーン

| 条件 | 称号 | 備考 |
|------|------|------|
| 累積CP 100到達 | 🌱 **芽吹き** | 初期の節目 |
| 累積CP 500到達 | 🌿 **市民** | 一人前 |
| 累積CP 1000到達 | 🌳 **功労者** | |
| 累積CP 5000到達 | 🏔️ **開拓者** | |
| 累積CP 10000到達 | ⭐ **建国の父/母** | |

#### 特殊アチーブメント

| 条件 | 称号 | 備考 |
|------|------|------|
| 30日連続参加 | 🔥 **皆勤の炎** | ストリーク系 |
| 100日連続参加 | ♾️ **不滅** | |
| 5つ以上のチャンネルで月間TOP3 | 🦊 **万能人** | 多面貢献系 |
| INFO + INSIGHT 合計が全体の60%以上 | 🎯 **知識特化型** | プレイスタイル系 |
| VIBE が全体の60%以上 | 🎉 **バイブス特化型** | |
| 初めての `/vote create` | 🗳️ **一石を投じた者** | ガバナンス系 |
| 重要決議の起案が可決 | 📜 **立法者** | |
| Issue 10件クローズ | 🛠️ **問題解決者** | 開発評価系（将来） |
| PR 5件マージ | 💻 **コードの錬金術師** | 開発評価系（将来） |

### 8-3. 称号の表示と管理

- 各メンバーは獲得済み称号の中から **表示称号を1つ選択** できる（Discord表示名に反映）
- 全獲得済み称号は `/mytitles` で一覧確認可能
- 称号獲得時にBotが `#称号発表` で通知（お祝いメッセージ付き）
- チャンネル覇者は毎月自動切り替え、累積アチーブメントは永続

```
/mytitles          → 獲得済み称号一覧 + 現在の表示称号
/settitle [称号名]  → 表示称号を変更
/titles @ユーザー   → 他メンバーの獲得称号を閲覧
```

---

## 9. Issue管理・開発評価

### 設計思想

Comm0nsのシステム開発やルール改善を、透明かつ追跡可能な形で管理する。GitHubのIssue/PRモデルをDiscordに統合し、開発貢献もCPとして正当に評価する。

### 9-1. Issue管理（Discord統合）

```
/issue create title:"Bot応答速度改善" 
  label:bug priority:medium
  description:"特定コマンドで3秒以上かかる"

/issue assign #42 @ユーザー
/issue status #42 in-progress
/issue close #42 "PR #15でマージ済み"
```

**Issueライフサイクル:**

```
  Open → Assigned → In Progress → Review → Closed
   │                                          │
   └──── Won't Fix ◄─────────────────────────┘
```

**ラベル体系:**

| ラベル | 説明 | 色 |
|-------|------|-----|
| `bug` | バグ・不具合 | 赤 |
| `feature` | 新機能リクエスト | 青 |
| `rule-change` | ルール・制度変更提案 | 紫 |
| `docs` | ドキュメント改善 | 黄 |
| `discussion` | 検討・議論が必要 | グレー |

**優先度:**

| 優先度 | 説明 |
|-------|------|
| `critical` | サービス停止レベル。即時対応 |
| `high` | 主要機能に影響。1週間以内 |
| `medium` | 改善推奨。スプリント内 |
| `low` | 余裕があれば |

### 9-2. 開発貢献のCP評価

コード・ドキュメント・設計への貢献をCPとして評価する。初期はDiscord上での手動記録、将来的にGitHub連携で自動化。

| アクション | CP | 備考 |
|-----------|-----|------|
| Issue起票 | +3 | 問題発見・提案は貢献 |
| Issue解決（クローズ） | +10〜+30 | 優先度に応じて変動 |
| コードレビュー実施 | +5 | レビュー文化の醸成 |
| PRマージ（小） | +15 | バグ修正、小機能 |
| PRマージ（中） | +30 | 新機能、リファクタリング |
| PRマージ（大） | +50 | システム設計レベルの貢献 |
| ドキュメント執筆・改善 | +10 | 知の資産化 |
| 設計レビュー参加 | +5 | 意思決定への関与 |

**PR規模の判定基準（初期は手動、将来自動化）:**
- 小: 変更行数 < 50行 or バグ修正
- 中: 50〜300行 or 新機能
- 大: 300行以上 or アーキテクチャ変更

### 9-3. GitHub連携（将来フェーズ）

```
┌──────────┐     Webhook     ┌──────────┐
│  GitHub  │ ──────────────→ │ Comm0ns  │
│  Repo    │                 │   Bot    │
│          │ ◄────────────── │          │
│ Issue/PR │   Status Update │ CP付与   │
└──────────┘                 └──────────┘
```

- GitHub Issue作成 → Discord `#dev-feed` に自動通知
- PR作成/マージ → 対応するDiscordメンバーにCP自動付与
- GitHubユーザーとDiscordユーザーの紐付けテーブルを管理

### 9-4. スプリント管理（将来フェーズ）

2週間単位のスプリントでIssueを管理。

```
/sprint create name:"Sprint 3" start:2026-03-01 end:2026-03-14
/sprint add #42 #43 #45
/sprint status                → 進捗サマリー表示
/sprint retro                 → 振り返り用テンプレート生成
```

スプリント完了時に参加者全員にボーナスCP（+20）を付与。

---

## 10. ダッシュボード & 可視化

### Discordコマンド一覧

| コマンド | 機能 |
|---------|------|
| `/mystats` | 自分のCP総計・TS・VP・ランキング・カテゴリ内訳 |
| `/mystats @ユーザー` | 他メンバーの公開スコア |
| `/leaderboard` | 月間CPランキングTOP10 |
| `/leaderboard category` | カテゴリ別ランキング |
| `/history` | 直近7日間の自分のCP獲得ログ |
| `/mytitles` | 獲得済み称号一覧 |
| `/settitle [称号名]` | 表示称号を変更 |
| `/vote create ...` | 投票を起案 |
| `/vote list` | 進行中の投票一覧 |
| `/issue create ...` | Issue起票 |
| `/issue list` | 未解決Issue一覧 |
| `/quest create ...` | クエスト発行（運営のみ） |
| `/dispute [メッセージID]` | 分類の異議申し立て |

### Webダッシュボード（将来）

※ 現在はTUI中心運用のため旧Web実装は撤去済み。将来的にアップデート版を再実装予定。

- メンバーごとのレーダーチャート（INFO / INSIGHT / VIBE / OPS）
- 月別トレンドグラフ
- コミュニティ全体の活動ヒートマップ
- VP分布の可視化（権力集中度のモニタリング）
- 称号ギャラリー（全称号の獲得条件と保持者一覧）
- Issue/スプリントのカンバンボード
- 分類ログの閲覧と異議申し立て

---

## 11. 技術構成

```
┌──────────────────────────────────────────────────────┐
│                   Discord Server                      │
│  メッセージ / リアクション / コマンド / VC / 投票       │
└───────────────────┬──────────────────────────────────┘
                    │ Discord.py
                    ▼
┌──────────────────────────────────────────────────────┐
│                Comm0ns Bot (Python)                    │
│                                                        │
│  ┌────────────────────────────────────────────────┐  │
│  │  メッセージ分類パイプライン                       │  │
│  │  Stage 1 (ルール) → Stage 2 (AI) → Stage 3 (人間) │  │
│  └────────────────────────────────────────────────┘  │
│                                                        │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐             │
│  │ CP計算   │ │ 議決権   │ │ 称号     │             │
│  │ エンジン │ │ エンジン │ │ エンジン │             │
│  └──────────┘ └──────────┘ └──────────┘             │
│                                                        │
│  ┌──────────┐ ┌──────────┐                          │
│  │ /vote    │ │ /issue   │                          │
│  │ ハンドラ │ │ ハンドラ │                          │
│  └──────────┘ └──────────┘                          │
└───────────────────┬──────────────────────────────────┘
                    │
        ┌───────────┼───────────┐
        ▼           ▼           ▼
┌────────────┐ ┌─────────┐ ┌─────────────┐
│ SQLite →   │ │ Claude  │ │ GitHub API  │
│ PostgreSQL │ │ API     │ │ (将来)      │
└────────────┘ └─────────┘ └─────────────┘
```

### データベーススキーマ（主要テーブル）

| テーブル | 用途 |
|---------|------|
| `members` | メンバー情報、累積CP、TS、VP |
| `messages` | 全メッセージログ + 分類結果 |
| `cp_ledger` | CP獲得履歴（台帳） |
| `ts_events` | TS変動イベント |
| `votes` | 投票定義 + 各メンバーの投票内容 |
| `vote_results` | 投票結果（永続記録） |
| `achievements` | 称号マスタ + 獲得条件 |
| `member_achievements` | メンバー × 称号の取得履歴 |
| `issues` | Issue定義 + ステータス |
| `quests` | クエスト定義と達成記録 |

### 技術選定

| レイヤー | 技術 | 理由 |
|---------|------|------|
| Bot | Python (discord.py) | エコシステム豊富、AI連携容易 |
| AI分類 | Claude API (Haiku) | コスト効率良好。将来Ollama移行可 |
| DB | SQLite（初期）→ PostgreSQL | 小規模スタート、スケール時に移行 |
| ダッシュボード | Discord Embed（初期）→ Web UI | Bot内完結からWebへ段階的拡張 |
| VCS連携 | GitHub Webhooks（将来） | Issue/PR連携 |

---

## 12. 実装ロードマップ

### Phase 1: 基盤構築（〜2週間）
- [ ] Bot基本フレームワーク（メッセージ受信・DB記録）
- [ ] Stage 1 ルールベース分類
- [ ] 既存ポイントからの移行（3pt/1pt → 新カテゴリCP）
- [ ] `/mystats` `/leaderboard` 実装
- [ ] **本設計書の導入決議を `/vote` で実施**

### Phase 2: 分類 + 社会機能（〜1ヶ月）
- [ ] Stage 2 AI分類バッチ
- [ ] Stage 3 レビューキュー
- [ ] 連続参加ボーナス
- [ ] 議決権（VP）計算と `/vote` 実装

### Phase 3: ゲーミフィケーション（〜2ヶ月）
- [ ] チャンネル重み係数
- [ ] TS（信頼スコア）連携
- [ ] アチーブメント・称号システム全体
- [ ] チャンネル覇者の月次自動更新
- [ ] クエストシステム

### Phase 4: 開発統合（〜3ヶ月）
- [ ] Issue管理（Discord内）
- [ ] 開発貢献のCP評価（手動記録）
- [ ] Webダッシュボード構築

### Phase 5: 外部連携 + 通貨（〜6ヶ月）
- [ ] GitHub連携（Webhook + 自動CP付与）
- [ ] スプリント管理
- [ ] CP → C0（内部通貨）変換ロジック
- [ ] ウォレット連携
- [ ] 貢献証明（Proof of Contribution）ログ

---

## 13. リスクと対策

| リスク | 影響 | 対策 |
|-------|------|------|
| CP稼ぎスパム | コミュニティ質低下 | 短時間大量投稿検知 → CP停止 + TS減点 |
| AI分類誤判定 | 不公平感 | Stage 3人間レビュー + `/dispute` 異議申し立て |
| 数値への本末転倒 | 文化の変質 | 定期的な「数値の意味」共有。非表示モード検討 |
| プライバシー懸念 | メンバー離脱 | 分類結果は本人のみ閲覧可。ランキングはオプトアウト可 |
| 議決権の偏り | 古参支配 | 対数スケール + VP上限6 + TS補正 |
| 称号インフレ | 称号の価値低下 | 閾値の定期見直し。希少称号は条件を厳しめに設定 |
| 開発評価の主観性 | 不満 | PR規模の明確な基準。将来的に自動計測へ移行 |

---

## 14. 付録

### 付録A: CP計算の完全フロー

```
1. メッセージ受信
2. カテゴリ分類（Stage 1/2/3）
3. 基本CP = カテゴリ別CPテーブルから取得
4. チャンネル補正 = 基本CP × チャンネル係数
5. TS補正 = チャンネル補正後CP × (TS / 100)
6. ボーナス加算（ストリーク、クエスト、投票参加等）
7. → cp_ledger に記録
8. → 累積CP更新 → VP再計算
9. → アチーブメント条件チェック → 該当あれば称号付与
```

### 付録B: AI分類プロンプト（Stage 2）

```
あなたはComm0nsコミュニティのDiscordメッセージ分類アシスタントです。
以下のメッセージを、前後の文脈を考慮して5つのカテゴリに分類してください。

## カテゴリ
- INFO: URL・記事・資料・データなど参照価値のある情報共有
- INSIGHT: 自分の経験・分析・提案などオリジナルの思考を伴う発言
- VIBE: 場の空気づくり、盛り上げ、歓迎、励まし、ユーモア
- OPS: イベント告知、スケジュール調整、タスク管理
- MISC: 上記に該当しない短文・独り言

## 判定ルール
- URLを含み説明や感想が添えられている → INFO
- URLなしだが体験談・分析・提案がある → INSIGHT
- 短文でも励まし・歓迎・盛り上げ意図が明確 → VIBE
- 日程調整・役割分担・進捗報告 → OPS
- 上記いずれにも当てはまらない → MISC

## 出力形式（JSON）
{"category": "INFO", "confidence": 0.85, "reason": "技術記事のURLと要約を共有"}
```

### 付録C: 初回導入決議のテンプレート

```
/vote create type:重要決議
  title:"Comm0ns Discord統合システム v2 の導入"
  description:"貢献度計測・議決権・称号システムを導入する。
    詳細は設計書を参照。まず土台として稼働させ、逐次修正を加える。"
  duration:7d
  options:"賛成,反対,修正条件付き賛成"
```
